{
  "title": "Stake Level Metrics",
  "schemaVersion": 39,
  "version": 1,
  "panels": [
    {
      "type": "timeseries",
      "title": "VPIP by stake",
      "targets": [
        {
          "query": "SELECT stake, vpip FROM stake_vpip",
          "datasource": {
            "type": "clickhouse",
            "uid": "${DS_CLICKHOUSE}"
          }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 50, "color": "red" }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "PFR by stake",
      "targets": [
        {
          "query": "SELECT stake, pfr FROM stake_pfr",
          "datasource": {
            "type": "clickhouse",
            "uid": "${DS_CLICKHOUSE}"
          }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 30, "color": "red" }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Avg action latency by stake",
      "targets": [
        {
          "query": "SELECT stake, latency_ms FROM stake_action_latency",
          "datasource": {
            "type": "clickhouse",
            "uid": "${DS_CLICKHOUSE}"
          }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
              { "value": 500, "color": "red" }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "ACK latency p50/p95/p99",
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(ack_latency_bucket[1m])) by (le))",
          "datasource": {
            "type": "prometheus",
            "uid": "${DS_PROMETHEUS}"
          }
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(ack_latency_bucket[1m])) by (le))",
          "datasource": {
            "type": "prometheus",
            "uid": "${DS_PROMETHEUS}"
          }
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(ack_latency_bucket[1m])) by (le))",
          "datasource": {
            "type": "prometheus",
            "uid": "${DS_PROMETHEUS}"
          }
        }
      ]
    }
  ]
}
